% !TeX root = ../main-conf.tex

\subsection{Digital circuits}
\label{sec:digital-circuits}

A traced monoidal theory with a comonoid structure that is of particular
interest to us is the \emph{local theory of sequential circuits} from
\cite[Sec. VI]{ghica2022compositional}.

\begin{definition}[Gate-level circuits]
    Let the monoidal theory of \emph{gate-level sequential circuits} be defined
    as \(
        (\generators[\mathbf{SCirc}], \equations[\mathbf{SCirc}])
    \), where \[
        \generators[\mathbf{SCirc}]
        :=
        \{
            \iltikzfig{circuits/components/gates/and},
            \iltikzfig{circuits/components/gates/or},
            \iltikzfig{circuits/components/gates/not},
            \iltikzfig{strings/structure/comonoid/copy}[comb],
            \iltikzfig{strings/structure/monoid/merge}[comb],
            \iltikzfig{strings/structure/comonoid/discard}[comb],
            \iltikzfig{circuits/components/values/v}[\belnapnone],
            \iltikzfig{circuits/components/values/v}[\belnaptrue],
            \iltikzfig{circuits/components/values/v}[\belnapfalse],
            \iltikzfig{circuits/components/values/v}[\belnapboth],
            \iltikzfig{circuits/components/waveforms/delay}
        \}
    \] and the equations of \(
        \equations[\mathbf{SCirc}]
    \) are listed in \cref{app:equations}, \cref{fig:circuit-equations}, where
    \(
        \gateinterpretation
    \) maps gates to the corresponding truth table in \cref{app:belnap},
    \(\ljoin\) is the join in the information lattice in \cref{app:belnap}, and
    \(
        \iltikzfig{circuits/components/circuits/f-1-2}[F^n][comb][m][x][n]
    \) is defined inductively as \(
        \iltikzfig{circuits/instant-feedback/f0-box}
        :=
        \iltikzfig{circuits/instant-feedback/f0-definition}
    \) and \(
        \iltikzfig{circuits/instant-feedback/fkp1-box}
        :=
        \iltikzfig{circuits/instant-feedback/fkp1-definition}
    \).
\end{definition}

The generators in \(\generators[\mathbf{SCirc}]\) are, respectively:
\(\andgate\), \(\orgate\) and \(\notgate\) gates; constructs for forking,
joining and stubbing wires; \emph{values} representing no signal, a true signal,
a false signal, and both signals at once; and a delay of one unit of time.


The equations of \(\equations[\mathbf{SCirc}]\) contain the equations of a
commutative comonoid, so this is a perfect use case for rewriting modulo
trace commutative comonoid structure.
Using graph rewriting, we can sketch out an \emph{operational semantics} for
sequential circuits.
For the interests of brevity, we will only consider circuits of the form \(
    \iltikzfig{circuits/productivity/mealy-form-verbose}
\): circuits with no `non-delay-guarded feedback' in which the registers of the
circuit have been isolated from a core \(
    \iltikzfig{strings/category/f-2-2}[F][comb]
\) containing only `blue' (\emph{combinational}) components, which models a
function.

We can `apply' such a circuit to an input as shown in the left-hand side of
\cref{fig:cycle}; \cite[Thm. 104]{ghica2022compositional} shows that the
equations in \(\equations[\mathbf{SCirc}]\) can be used to derive the right-hand
side.
The equations \eqref{eq:gate,eq:fork,eq:join,eq:stub} can then be applied to
reduce the two `new' cores down to values, which represent the output and new
state of the circuit.

When the circuits are interpreted as hypergraphs and the equations as rewrites,
it would be possible for a computer to perform this sequence of rewrites to
evaluate circuits while being able to `peek inside' and see what is going on.

\begin{remark}
    This is another framework which would benefit from a way of formalising
    subgraphs in rewrite rules.
\end{remark}

\begin{figure*}
    \centering
    \begin{equation*}
        \tag{\(\mathsf{Cycle}\)}
        \iltikzfig{circuits/productivity/productive-lhs-verbose}[F][s][v]
        =
        \iltikzfig{circuits/productivity/productive-step-9}
        \label{eq:cycle}
    \end{equation*}
    \caption{
        The cycle equation, which is derivable from the equations in
        \(\equations[\mathbf{SCirc}]\)
    }
    \label{fig:cycle}
\end{figure*}
